<!doctype html>

<body>
    <script>
        //      ------ HTML creation  --------
        let way = document.body;
        let wayCanvas = document.createElement('canvas')
        way.prepend(wayCanvas);

        wayCanvas.setAttribute('id', 'myCanvas');

        let findCanvas = document.getElementById('myCanvas');

        findCanvas.setAttribute('width', 600);
        findCanvas.setAttribute('height', 500);
        findCanvas.setAttribute('style', 'border:1px solid #0bcddb73; background: #eee')

        let c = document.getElementById('myCanvas');
        let ctx = c.getContext('2d');

        let findDiv = document.createElement('div');
        way.prepend(findDiv);

        findDiv.innerHTML = 'координаты Canvas';


        //     --------------------BUTTON --------------------


        //     ------------------- FIGURE --------------------


        //                         CIRCLE
        let circle = document.createElement('input');
        way.append(circle);
        circle.value = 'circle';
        circle.type = 'button';
        circle.style.cssText = `margin-left: 20px;
        margin-top: 30px;
        width: 43px;
        text-align: center;
        `;

        circle.addEventListener('click', () => {
            checkCircle = 'on';
            checkRec = 'off';
            checkTriangle = 'off';
            type = 'circle';
            findCanvas.addEventListener('mousedown', startCoor);

        })

        //                         TRIANGLE

        let triangle = document.createElement('input');
        way.append(triangle);
        triangle.value = 'triangle';
        triangle.type = 'button';
        triangle.style.cssText = `margin-left: 20px;
        margin-top: 30px;
        width: 70px;
        text-align: center;
        `;

        triangle.addEventListener('click', () => {
            checkTriangle = 'on';
            checkRec = 'off';
            checkCircle = 'off';
            findCanvas.addEventListener('mousedown', startCoor);
        });


        //                         RECTANGLE

        let rectangle = document.createElement('input');
        way.append(rectangle);
        rectangle.value = 'rectangle';
        rectangle.type = 'button';
        rectangle.style.cssText = `margin-left: 20px;
        margin-top: 30px;
        width: 70px;
        text-align: center;
        `;

        rectangle.addEventListener('click', () => {
            checkRec = 'on';
            checkCircle = 'off';
            checkTriangle = 'off';
            type = 'rectangle';
            findCanvas.addEventListener('mousedown', startCoor);
        });


        //                                  LINE

        let lineS = document.createElement('input');
        way.append(lineS);
        lineS.value = 'line';
        lineS.type = 'button';
        lineS.style.cssText = `margin-left: 20px;
        margin-top: 30px;
        width: 70px;
        text-align: center;
        `;

        lineS.addEventListener('click', () => {
            checkTriangle = 'off';
            checkRec = 'off';
            checkCircle = 'off';
            type = 'line';
            findCanvas.addEventListener('mousedown', startCoor);
        })


        //  ---------------------- COLOR ---------------------------------


        //                          RED

        let buttonRed = document.createElement('input');
        way.append(buttonRed);

        buttonRed.type = 'button';
        buttonRed.style.marginLeft = '50px';
        buttonRed.style.marginTop = '10px';
        buttonRed.value = 'color';
        buttonRed.style.backgroundColor = 'red';

        buttonRed.onclick = () => lineColor = 'red';


        //                          BLACK

        let buttonBlack = document.createElement('input');
        way.append(buttonBlack);
        buttonBlack.type = 'button';
        buttonBlack.value = 'color';
        buttonBlack.style.cssText = `margin-left: 10px;
        margin-top: 10px;
        width: 43px;
        color: white;
        background-color: black; 
        text-align: center;
        `;

        buttonBlack.onclick = () => lineColor = 'black';


        //    ----------------   EVENT CREATION --------------------
        let x = Number();
        let y = Number();
        let x1 = Number();
        let y1 = Number();
        let x2 = Number();
        let y2 = Number();

        let type = 'line';


        let canvasX = findCanvas.getBoundingClientRect().x;
        let canvasY = findCanvas.getBoundingClientRect().y;

        let lineColor = 'black';


        let checkCircle = 'off';
        let checkRec = 'off';
        let checkTriangle = 'off';
        let checkNum = 0;

        let saveMass = [];

        class Coordinates {
            constructor(x, y, x1, y1, lineColor, type) {
                this.pointX = x;
                this.pointY = y;
                this.pointX1 = x1;
                this.pointY1 = y1;
                this.col = lineColor;
                this.typeClass = type;
            }
        }
        class Line extends Coordinates {
            constructor(x, y, x1, y1, lineColor, type) {
                super(x, y, x1, y1, lineColor, type);
            }

            drawing() {
                ctx.beginPath();
                ctx.lineWidth = 2;
                ctx.strokeStyle = this.col;
                ctx.moveTo(this.pointX, this.pointY);
                ctx.lineTo(this.pointX1, this.pointY1);
                ctx.stroke();
            }
        }

        class Triangle extends Coordinates {

            constructor(x, y, x1, y1, lineColor, type, x2, y2) {
                super(x, y, x1, y1, lineColor, type);
                this.pointX2 = x2;
                this.pointY2 = y2;
            }
            drawing() {
                ctx.beginPath();
                ctx.lineWidth = 2;
                ctx.strokeStyle = this.col;
                ctx.moveTo(this.pointX, this.pointY);
                ctx.lineTo(this.pointX1, this.pointY1);
                ctx.lineTo(this.pointX2, this.pointY2);
                ctx.lineTo(this.pointX, this.pointY);
                ctx.stroke();
            }

        }
        class Rectangle extends Coordinates {
            constructor(x, y, x1, y1, lineColor, type) {
                super(x, y, x1, y1, lineColor, type);
            }

            drawing() {
                ctx.beginPath();
                ctx.lineWidth = 2;
                ctx.strokeStyle = this.col;
                ctx.rect(this.pointX, this.pointY, this.pointX1 - this.pointX, this.pointY1 - this.pointY);
                ctx.stroke();
            }
        }

        class Circle extends Coordinates {
            constructor(x, y, x1, y1, lineColor, type) {
                super(x, y, x1, y1, lineColor, type);
            }
            drawing() {
                ctx.beginPath();
                ctx.arc(this.pointX, this.pointY, Math.hypot(this.pointX1 - this.pointX, this.pointY1 - this.pointY), 0, 2 * Math.PI);
                ctx.lineWidth = 2;
                ctx.strokeStyle = this.col;
                ctx.stroke();
            }
        }



        // let lineObj = new Line(x, y, x1, y1, lineColor, type);

        // let point = new Coordinates(x, y, x1, y1, lineColor, type);

        // function change() {
        //     point = new Coordinates(x, y, x1, y1, lineColor, type);
        // }


        findCanvas.addEventListener('click', (e) => {
            findDiv.innerHTML = (e.clientX - canvasX) + ':' + (e.clientY - canvasY);
        })

        //    ----------------------------------------------------------------------
        //-------------------------------------Start -----------------------------------------
        //----------------------------------------------------------------------

        findCanvas.addEventListener('mousedown', startCoor);

        function startCoor(e) {


            if (event.which === 1) {

                if (checkTriangle === 'on') {
                    if (checkNum === 0) {
                        x = e.clientX - canvasX;
                        y = e.clientY - canvasY;
                        checkNum = 1;
                    } else if (checkNum === 1) {
                        x1 = e.clientX - canvasX;
                        y1 = e.clientY - canvasY;
                        checkNum = 2;
                    } else if (checkNum === 2) {
                        x2 = e.clientX - canvasX;
                        y2 = e.clientY - canvasY;
                        checkNum = 0;

                        let triangleObj = new Triangle(x, y, x1, y1, lineColor, type, x2, y2);
                        saveMass.push(triangleObj);
                        triangleObj.drawing();
                        console.log(saveMass)
                    }
                } else {
                    x = e.clientX - canvasX;
                    y = e.clientY - canvasY;

                    findCanvas.addEventListener('mousemove', setCoordinates);
                }
            }
        }


        function recovery() {
            for (let sort of saveMass) {
                sort.drawing();
            }
        }

        function setCoordinates(e) {

            ctx.clearRect(0, 0, 600, 500);

            x1 = e.clientX - canvasX;
            y1 = e.clientY - canvasY;

            recovery();


            // change();

            if (checkRec === 'off' && checkCircle === "off" && checkTriangle === 'off') {
                lineObj = new Line(x, y, x1, y1, lineColor, type);
                lineObj.drawing();
            }

            if (checkCircle === 'on') {
                circleObj = new Circle(x, y, x1, y1, lineColor, type);
                circleObj.drawing();
            }

            if (checkRec === 'on') {
                rectangleObj = new Rectangle(x, y, x1, y1, lineColor, type);
                rectangleObj.drawing();
            }
            // if (checkTriangle === 'on') {
            //     let triangleObj = new Triangle(x, y, x1, y1, lineColor, x2, y2);
            //     triangleObj.drawing();
            // }
        }

        findCanvas.addEventListener('mouseup', finish);

        function finish(e) {

            if (event.which === 1) {

                findCanvas.removeEventListener('mousemove', setCoordinates);

                x1 = e.clientX - canvasX;
                y1 = e.clientY - canvasY;

                //change();

                if (x !== x1 || y !== y1) {


                    // saveMass.push(point);

                    // console.log(saveMass);
                    // console.log(type);
                    if (checkRec === 'off' && checkCircle === 'off' && checkTriangle === 'off') {

                        let lineObj = new Line(x, y, x1, y1, lineColor, type);

                        saveMass.push(lineObj);
                        console.log(saveMass);

                        // indLine.push(saveMass.length - 1);
                        // point.drawLine();

                    }

                    if (checkCircle === 'on') {
                        let circleObj = new Circle(x, y, x1, y1, lineColor, type);

                        saveMass.push(circleObj);
                        console.log(saveMass);
                        // indCircle.push(saveMass.length - 1);
                        // point.drawCircle();
                    }

                    if (checkRec === 'on') {
                        let rectangleObj = new Rectangle(x, y, x1, y1, lineColor, type);
                        saveMass.push(rectangleObj);
                        console.log(saveMass);
                        // indRect.push(saveMass.length - 1);
                        // point.drawRectangle();
                    }
                    // if (checkTriangle === 'on') {
                    //     // indTriangle.push(saveMass.length - 1);
                    //     // point.drawTriangle();
                    // }
                }
            }
        }


        findCanvas.addEventListener('contextmenu', () => {

            ctx.clearRect(0, 0, 600, 500);
            saveMass.pop();

            for (let sort of saveMass) {
                sort.drawing();
            }

            event.preventDefault();
        })





        // findCanvas.addEventListener('contextmenu', clearLastLine);

        // function clearLastLine() {


        //     if (indLine[indLine.length - 1] === saveMass.length - 1) {
        //         indLine.pop();

        //     } else if (indRect[indRect.length - 1] === saveMass.length - 1) {
        //         indRect.pop();
        //     } else if (indCircle[indCircle.length - 1] === saveMass.length - 1) {
        //         indCircle.pop();
        //     } else {
        //         indTriangle.pop();
        //     }

        //     ctx.clearRect(0, 0, 600, 500);

        //     saveMass.pop(point);

        //     recovery();
        //     event.preventDefault();
        // }
    </script>
</body>